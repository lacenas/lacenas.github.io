<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CSV Filtered View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>Filtered Results</h1>
  <div id="output">Loading...</div>

  <script>
    function getParams() {
      const params = new URLSearchParams(window.location.search);
      return Object.fromEntries(params.entries());
    }

    function matches(row, filters) {
      return Object.entries(filters).every(([key, val]) => {
        return row[key] === val;
      });
    }

    function showResults(data, filters) {
      const filtered = data.filter(row => matches(row, filters));
      const output = document.getElementById("output");

      if (filtered.length === 0) {
        output.innerHTML = "<p>No results found.</p>";
        return;
      }

      const html = `<table border="1">
        <tr>${Object.keys(filtered[0]).map(k => `<th>${k}</th>`).join("")}</tr>
        ${filtered.map(row => `<tr>${Object.values(row).map(v => `<td>${v}</td>`).join("")}</tr>`).join("")}
      </table>`;
      output.innerHTML = html;
    }

    // Load and parse CSV
    const filters = getParams();
    Papa.parse("data/mydata.csv", {
      download: true,
      header: true,
      complete: function(results) {
        showResults(results.data, filters);
      }
    });
  </script>
</body>
</html>
